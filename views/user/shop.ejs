<%- include("../../views/partials/user/header") %>
<style>
 .main-container {
   max-width: 1200px;
   margin: 0 auto;
   padding: 20px;
 }
 .shop-topbar {
    width: 100%;
    display: flex;
    justify-content: center; /* Center the search bar */
}

.search-bar {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.search-form {
    display: flex;
    width: 350px;  /* Adjust width */
    align-items: center;
    background-color: #f1f1f1;
    border-radius: 25px;
    overflow: hidden;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    /* padding: 5px 15px; */
    position: relative;
}

.search-input {
    flex: 1;
    padding: 8px 10px;
    font-size: 14px;
    border: none;
    outline: none;
    background-color: transparent;
}

.clear-btn {
    position: absolute;
    right: 100px;
    font-size: 16px;
    color: #888;
    cursor: pointer;
    display: none;
}

.clear-btn:hover {
    color: #333;
}

.search-button {
  display: flex;
    padding: 8px 15px;
    background-color: #1e918b;
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 14px;
    border-radius: 25px;
    margin-left: 10px; /* Space between input and button */
    transition: background-color 0.3s, transform 0.2s;
}

.search-button:hover {
    background-color: #0056b3;
    transform: scale(1.05);
}

 .sidebar {
   padding: 20px;
   border: 1px solid #ddd;
   background-color: #f9f9f9;
   border-radius: 8px;
   margin-bottom: 20px;
   width: 250px;
   text-align: center;
 }


 .filter-section {
   margin-bottom: 20px;
 }


 .filter-title {
   font-weight: bold;
   margin-bottom: 10px;
   font-size: 16px;
   color: #333;
 }


 .filter-item {
   margin: 5px 0;
 }


 .filter-item a {
   text-decoration: none;
   color: #333;
 }


 .filter-item a:hover {
   color: #007bff;
 }


 .product-list-container {
   display: flex;
   gap: 20px;
 }


 .product-grid {
   display: flex;
   flex-wrap: wrap;
   gap: 20px;
   width: calc(100% - 270px);
 }


 .product-card {
   width: calc(33.333% - 20px);
   border: 1px solid #ddd;
   padding: 15px;
   border-radius: 8px;
   text-align: center;
   position: relative;
 }


 .product-card img {
   max-width: 100%;
   height: auto;
   border-radius: 5px;
 }


 .wishlist-btn {
   position: absolute;
   top: 8px;
   right: 8px;
   background-color: rgba(237, 247, 247, 0.8);
   color: #fff;
   padding: 8px;
   border-radius: 50%;
   cursor: pointer;
 }


 .add-to-cart-btn {
   background-color: #46698f;
   color: #fff;
   padding: 10px;
   border: none;
   border-radius: 5px;
   cursor: pointer;
   width: 100%;
   margin-top: 10px;
 }


 .pagination {
   display: flex;
   justify-content: center;
   gap: 10px;
   margin: 20px 0;
 }


 .pagination a {
   padding: 8px 12px;
   background-color: #f0f0f0;
   border: 1px solid #ddd;
   color: #333;
   text-decoration: none;
 }


 .pagination .active {
   background-color: #007bff;
   color: #fff;
 }


 .price-filter {
   padding: 10px;
   background-color: #f9f9f9;
   border-radius: 8px;
   margin-top: 20px;
 }


 .price-filter .price-options {
   display: flex;
   flex-direction: column;
   gap: 10px;
 }


 .price-button {
   padding: 12px 20px;
   background-color: #f1f1f1;
   color: #333;
   border: 1px solid #ddd;
   border-radius: 30px;
   cursor: pointer;
   transition: background-color 0.3s, transform 0.2s;
   text-align: center;
   font-size: 14px;
 }


 .price-button:hover {
   background-color: #007bff;
   color: white;
   transform: scale(1.05);
 }


 .price-button:active {
   transform: scale(0.95);
 }


 .category-brand-container {
   text-align: center;
 }

 .marquee-container {
      overflow: hidden;
      position: relative;
      width: 100%;
      background: #f9f9f9;
      padding: 20px 0;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .marquee-content {
      display: flex;
      animation: marquee 30s linear infinite;
      width: max-content;
    }
    
    .brandLogo {
      height: 50px;
      margin: 0 30px;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
      transition: transform 0.3s ease;
    }
    
    .brandLogo:hover {
      transform: scale(1.1);
    }
    
    @keyframes marquee {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }
    
    /* Pause animation on hover */
    .marquee-container:hover .marquee-content {
      animation-play-state: paused;
    }

</style>

<div class="page-header breadcrumb-wrap">
  <div class="container">
      <div class="breadcrumb">
          <a href="/" rel="nofollow">Home</a>
          <span></span> shop
      </div>
  </div>
</div>

<br>
<div class="marquee-container">
  <div class="marquee-content">
    <img class="brandLogo" src="/img/BrandLogos/apple.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/jbl.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/skullcandy.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/Sony_logo.svg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/AKG_logo.svg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/austian.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/beats.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/bose.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/bowers.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/hifi.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/NEW-A-T-Blog-Cover-Photo-12.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/philips.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/sennheiser.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/skull.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/noice.png" alt="">
    
    <!-- Duplicate logos to create seamless loop -->
    <img class="brandLogo" src="/img/BrandLogos/apple.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/jbl.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/skullcandy.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/Sony_logo.svg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/AKG_logo.svg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/austian.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/beats.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/bose.jpeg" alt="">
    <img class="brandLogo" src="/img/BrandLogos/bowers.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/hifi.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/NEW-A-T-Blog-Cover-Photo-12.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/philips.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/sennheiser.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/skull.png" alt="">
    <img class="brandLogo" src="/img/BrandLogos/noice.png" alt="">
  </div>
</div>


<div class="main-container">
 <section class="shop-page container">
   <div class="shop-topbar">
     <div class="search-bar">
      <div>
       <form action="/search" method="POST" class="search-form">
         <input type="text" name="search" placeholder="Search items..." class="search-input" value="<%= locals.searchValue %>">
         <span class="clear-btn" id="clearSearch">&times;</span> 
         <button type="submit" class="search-button">Search</button>
       </form>
       </div>
     </div>
   </div> <br>

   <div>
    <% if (locals.count) { %>
      <p> <%= locals.count %> results are found </p>
    <% } %>
   </div>
  <!-- categories -->
   <div class="product-list-container">
     <aside class="sidebar">
       <div class="filter-section">
         <div class="filter-title">Categories</div>
         <div class="category-brand-container">
           <ul>
            <% for (let i = 0; i < category.length; i++) { %>
               <li class="filter-item">
                 <a href="/filter?categoryId=<%= category[i]._id %>&filter<%= filter %>"> <%= category[i].name %> </a>
               </li>
            <% } %>
           </ul>
         </div>
       </div>


      
       <!-- <div class="filter-section">
         <div class="filter-title">Brands</div>
         <div class="category-brand-container">
           <ul>
               <li class="filter-item">
                 <a href=""></a>
               </li>
           </ul>
         </div>
       </div> -->

       

      
       <div class="price-filter">
         <div class="filter-title">Filter by Price</div>
         <form id="price-filter-form">
           <div class="price-options" >
             <a  href="/filterPrice?gt=0&lt=500">Under ₹500</a>
             <a href="/filterPrice?gt=500&lt=1000">₹500 - ₹1000</a>
             <a href="/filterPrice?gt=1000&lt=1500">₹1000- ₹1500</a>
             <a href="/filterPrice?gt=1500&lt=100000">Above ₹1500</a>
           </div>
         </form>
       </div>

       <br>
       <div class="filter-section">
        <div class="filter-title">Sorted By</div>
        <div class="category-brand-container">
          <ul>
              <li class="filter-item">
                <a href="/filterPriceLowToHigh"> Price: Low to High </a>
              </li>
              <li class="filter-item">
                <a href="/filterPriceHighToLow"> Price: High to Low </a>
              </li>
              <li class="filter-item">
                <a href="/filterA-Z"> Name: A-Z </a>
              </li>
              <li class="filter-item">
                <a href="/filterZ-A"> Name: Z-A </a>
              </li>
          </ul>
        </div>
      </div>

       <!-- Clear filter btn -->
       <br><div>
        <a href="/shop"><button type="button" class="btn btn-outline-secondary">Clear Filters</button></a>
       </div>

     </aside>


     <main class="product-grid">
        <% for(let i = 0; i < products.length; i++) { %>
         <div class="product-card">
           <span class="wishlist-btn" onclick="addToWishlist('<%= products[i]._id %>')">❤️</span>
           <a href="/productDetails?id=<%= products[i]._id %>">
             <img src="/uploads/re-images/<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>" />
             <h4><%= products[i].productName %></h4>
             <!-- <p></p>     Brand -->
             <p> <%= products[i].salePrice.toLocaleString('en-IN', { style: 'currency', currency: 'INR' }) %> <span class="text-muted"><strike> <%= products[i].regularPrice.toLocaleString('en-IN',{ style: 'currency', currency: 'INR' }) %> </strike></span></p>
           </a>
       
           <% if (locals.cartData) { %>
           <button class="add-to-cart-btn" onclick="addToCart('<%= products[i]._id %>')">Add to Cart</button>
           <% } else { %>
            <a href="/cart">
            <button class="add-to-cart-btn" >Go to Cart</button>
            </a>
            <% } %>
  
         </div>
         <% } %>
     </main>
   </div>


<!-- Pagination -->
   <div class="pagination">

    <% if (currentPage > 1) { %>
        <a class="btn" href="/shop?page=<%= currentPage - 1 %>">Prev</a>
      <% } %>
 
 
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a class="btn <%= currentPage === i ? 'active' : '' %>" href="/shop?page=<%= i %>"><%= i %></a>
      <% } %>
 
 
      <% if (currentPage < totalPages) { %>
        <a class="btn" href="/shop?page=<%= currentPage + 1 %>">Next</a>
      <% } %>
 
   </div>

   <!-- <div class="pagination">
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a class="btn <%= currentPage === i ? 'active' : '' %>" href="?page=<%= i %>&filter=<%= filter %>"><%= i %></a>
      <% } %>
   </div> -->
  
 </section>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>




<script>
  function addToWishlist(productId){

    $.ajax({

      url: "/addToWishlist",
      method: "POST",
      data: {productId: productId},
      success: (response) => {
        if (response.status === true) {

          Swal.fire({
            title: response.message || "Added",
            text: "Product has been added to your wishlist",
            icon: "success",
            // timer: 2000
          });

        } else {
          Swal.fire({
            title: "Already in wishlist",
            text: response.message,
            icon: "info",
            // timer: 2000
          });
        };
      },
      error: (error) => {
        Swal.fire({
          title: "Error",
          text: error.message || "There was an error in adding the product to wishlis",
          icon: "error",
          // timer: 2000
        })
      }

    })

  };


  // Add to cart function
  function addToCart(productId) {
    $.ajax({
        url: "/addToCart",
        method: "POST",
        data: { productId: productId },
        success: (response) => {
            if (response.status === true) {
                Swal.fire({
                    title: response.message || "Product Added",
                    text: "Product has been added to your cart",
                    icon: "success",
                    timer: 3000
                })
            } else {
                Swal.fire({
                    title: "Product already in cart",
                    text: response.message || "Check your cart",
                    icon: "info",
                    timer: 3000
                })
            }
        },
        error: (error) => {
            Swal.fire({
            title: "Error",
            text: error.message || "There was an error in adding the product to cart",
            icon: "error",
            timer: 3000
            })
        }
    })
  };

    // function addToCart(productId) {
    //   fetch("/addToCart", {
    //       method: "POST",
    //       headers: {
    //           "Content-Type": "application/json"
    //       },
    //       body: JSON.stringify({ productId })
    //   })
    //   .then(response => response.json())
    //   .then(data => {
    //       if (data.status === true) {
    //           Swal.fire({
    //               title: data.message || "Product Added",
    //               text: "Product has been added to your cart",
    //               icon: "success",
    //               timer: 3000
    //           });
    //       } else {
    //           Swal.fire({
    //               title: "Product already in cart",
    //               text: data.message || "Check your cart",
    //               icon: "info",
    //               timer: 3000
    //           });
    //       }
    //   })
    //   .catch(error => {
    //       Swal.fire({
    //           title: "Error",
    //           text: error.message || "There was an error in adding the product to cart",
    //           icon: "error",
    //           timer: 3000
    //       });
    //   });
    // }


</script>


<%- include("../../views/partials/user/footer") %>